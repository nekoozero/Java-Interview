# 索引

索引用于快速找出在某一个列中有特定值的行。不使用索引，Mysql 必须从第一条记录开始读完整个表，直到找出相关的行。表越大，查询数据所花费的时间越多。如果表中查询的列有一个索引，Mysql 能快速到达某个位置去搜寻数据文件，而不必查看所有数据。

## 含义和特点

索引是一个单独的、存储在磁盘上的数据库结构，它们包含着对数据表里所有记录的引用指针。使用索引用于快速找出摸个或多个列中有一特定值的行，所有 Mysql 列类型都可以被索引，对相关列使用索引是提高查询操作速度的最佳途径。

例子：

数据库中有2万条记录，现在要执行这样一个查询：select * from table where num=10000。如果没有索引，必须遍历整个表，直到 num 等于10000的这一行被找到为止；如果在 num 列上创建索引，Mysql 就不需要任何扫描，直接在索引里面找10000，就可以得知这一行的位置。可见，索引的创立可以提高数据库的查询速度。

索引实在存储引擎中实现的，因此，每种存储引擎的索引都不一定完全相同，并且每种存储引擎也不一定支持所有的索引类型。根据存储引擎定义每个表的最大索引数和最大索引长度。所有存储引擎支持每个表至少16个索引，总索引长度至少为256字节。大多数存储引擎有更高的限制。Mysql 中索引的存储类型有两种：BTREE 和 HASH，具体和标的存储引擎相关；MyISAM 和 InnoDB 存储引擎只支持 BTREE 索引；MEMORY/HEAP 存储引擎可以支持 HASH 和 BTREE 索引。

索引的优点主要由以下几条：

1. 通过创建唯一索引，可以保证数据库表中每一行数据的唯一性。
2. 可以大大加快数据的查询速度，这也是创建索引的最主要原因。
3. 在实现数据的参考完整性方面，可以加速表与表之间的连接。
4. 在使用分组和排序字句进行数据查询时，也可以显著减少查询中分组和排序的时间。

不利：

1. 创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加。
2. 索引需要占磁盘空间，除了数据表占数据空间外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件可能比数据文件更快达到最大文件尺寸。
3. 当对表中的数据进行增加、删除和修改的时候，索引也要动态维护，这样就降低了数据的维护速度。

## 分类

### 1.普通索引和唯一索引

普通索引是 Mysql 中的基本索引类型，允许在定义索引的列中插入重复值和空值。

唯一索引，索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。主键索引是一种特殊的唯一索引，不允许有空值。

### 2.单列索引和组合索引

单列索引即一个索引只包含单个列，一个表可以有多个单列索引。

组合索引只在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用。使用组合索引时遵循最左前缀集合。

### 3.全文索引

全文索引类型为 FULLTEXT，在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。全文索引可以在 CHAR、VARCHAR 或者 TEXT 类型的列上创建。Mysql 中只有 MyISAM 存储引擎支持全文索引。

### 4.空间索引

空间索引是对空间数据类型的字段建立的索引，Mysql 中的空间数据类型有4种，分别是：GEMETRY、POINT、LINSTRING 和 POLYGON。Mysql 使用 SPATIAL 关键字进行扩展，使能够用于创建正规索引类似的语法创建空间索引。创建空间索引的列，必须将其声明为 NOT NULL，空间索引只能在存储引擎为 MyISAM 的表中创建。

## 索引的设计原则

- 索引并非越多越好，一个表中如有大量的索引，不仅占用磁盘空间，而且会影响 INSERT、DELETE、UPDATE 等语句的性能，因为当表中的数据更改的同时，索引也会进行调整和更新。
- 避免对经常更新的表进行过多的索引，并且索引中的列尽可能少。而对经常用于查询的字段应该创建索引，但要避免添加不必要的字段。
- 数据量小的表最好不要使用索引，由于数据较少，查询花费的时间可能比遍历索引的时间还要短，索引可能不会产生优化效果。
- 在条件表达式中经常用到的不同值较多的列上建立索引，在不同值很少的列上不要建立索引。比如在学生表的“性别”字段上只有“男”、“女”两个不同值，因此就无须建立索引。如果建立索引不但不会提高查询效率，反而会严重降低数据更新速度。
- 当唯一性是某种数据本身的特征时，指定唯一索引。使用唯一索引需能确保定义的列的数据完整性，以提高查询速度。
- 当唯一性是某种数据本身的特征时，指定唯一索引。使用唯一索引需能确保定义的列的数据完整性，以提高查询速度。
- 在频繁进行排序或分组（即进行 group by 或 order by 操作）的列上建立索引，如果待排序的列有多个，可以再这些列上建立组合索引。


## 问题
1. 索引对数据库性能如此重要，应该如何使用它？

为数据库选择正确的索引是一项复杂的任务。如果索引列较少，则需要的磁盘空间和维护开销都较少。如果在一个大表上创建了多种组合索引，索引文件也会膨胀很快。而另一方面，索引较多可覆盖更多的查询。可能需要实验若干不同的设计，才能找到最有效的索引。可以添加、修改和删除索引而不影响数据库架构或应用程序设计。因此，应尝试多个不同的索引从而建立最优的索引。

2. 尽量使用短索引

对字符串类型的字段进行索引，如果可能应该指定一个前缀长度。例如，如果有一个 CHAR(255) 的列，如果在前10个或30个字符内，多数值是唯一的，则不需要对整个列进行索引，短索引不仅可以提高查询速度而且可以节省磁盘空间、减少I/O操作。
